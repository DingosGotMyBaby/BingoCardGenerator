<!DOCTYPE html>
<html>
<head>
<title>Bingo Card Generator</title>
<style type="text/css">
	label,input, select {
		display:block;
	}
	input,select {
		margin-bottom:.5em;
	}
	legend { font-weight: bold }
	div.clear { clear:both; }
	div.break { clear:both; page-break-after: always; }
	table {
		background-color:black;
		border-collapse:collapse;
		margin-bottom:1em;
		margin-right:1em;
		float:left;
	}
	td, th {
		border:1px solid black;
		text-align:center;
	}
	th {
		color:white;
		height:50px;
		font-family:Arial,Helvetica;
		font-size:24px;
	}
	td {
		background-color:white;
		width:85px;
		height:85px;
	}
	.freespace {
		font-size:smaller;
	}
	#footer {
		border-top:1px solid #ccc;
		clear:both;
	}
</style>
<style type="text/css" media="print">
	h1, form, #footer { display:none }
</style>

<script type="text/javascript" src="jquery-1.5.1.min.js"></script>
<script type="text/javascript">
// Generate Bingo Cards
function generate() {

	// Check to make suer enough options are provided to fill the bingo card spaces
	var spaces = $("#words").val().split(",").length;
	if ( $("#freespace").val() ) spaces++;
	if ( spaces < $("#width").val()*$("#height").val() )
		alert("Warning: you do not have enough possible board options for the size of the board you selected!");

	// Clear any previous results
	$("#results").html("");

	// Try to make nice printable pages -- we can fit about 10 pieces across and 6 down
	var colsFilled = 0;
	var rowsFilled = 1;

	// Loop over number of cards requested
	for ( var i=0; i<document.getElementById("number").value; i++ ) {

		colsFilled++;
		if ( colsFilled*$("#width").val() > 10 ) {
			rowsFilled++;
			if ( rowsFilled*$("#height").val() > 6 ) {
				$("#results").append('<div class="break"></div>');
				rowsFilled=1;
			} else {
				$("#results").append('<div class="clear"></div>');
			}
			colsFilled=1;
		}

		// Create bingo card
		var b = new BingoCard(
			$("#title").val(),
			$("#width").val(),
			$("#height").val(),
			$("#freespace").val(),
			$("#freespaceValue").val(),
			$("#freespaceRandom").val(),
			$("#words").val()
		);
	}
	
	// Jump to results
	location.href='#results';

}

function formatFreespace(str) {
	return '<strong>'+str+'<div class="freespace">Free Space</div></strong>';
}

function BingoCard(title,width,height,freespace,freespaceValue,freespaceRandom,list) {
	var possibleSpaces = list.split(",");
	
	// Two options for including random Free Space:
	// Option 1: We don't have enough. Include in random placement.
	// Option 2:- We have enough. Overwrite other option.
	var enoughSpaces = true;
	if ( possibleSpaces.length < width*height )
		enoughSpaces = false;

	// Option 1
	if ( freespace=="true" && freespaceRandom=="true" && !enoughSpaces )
		possibleSpaces.push(formatFreespace(freespaceValue));
	
	// Create a random selection of the possible values
	var spaces = [];

	// This works for squares with odd dimensions,, e.g. 3x3 or 5x5, but not for even squares or rectangles
	// var centerSquare = Math.floor(width*height/2);
	// We'll say center is the center row of the center column
	var centerSquare = Math.floor(height/2)*width + Math.floor(width/2);

	for ( var i=0; i<=width*height; i++ ) {
		if ( i==centerSquare && freespace=="true" && freespaceRandom=="false" ) 
			spaces.push(formatFreespace(freespaceValue));
		else
			spaces.push(possibleSpaces.splice(Math.floor(Math.random()*possibleSpaces.length),1)[0]);
	}

	// Option 2
	if ( freespace=="true" && freespaceRandom=="true" && enoughSpaces )
		spaces[Math.floor(Math.random()*spaces.length)] = formatFreespace(freespaceValue);

	// Output
	var output = '<table><thead><tr><th colspan="'+width+'">'+title+'</th></tr></thead>';
	output += '<tbody>';
	for ( var i=0; i<height; i++ ) {
		output += '<tr>';
		for ( var j=0; j<width; j++ ) 
			output += '<td>'+ spaces.shift() +'</td>';
		output += '</tr>';
	}
	output += "</tbody></table>";
	$("#results").append(output);

}

// Replace %2C with comma and + with spaces
function urlUnencode(str) {
	return str.replace(/%2C/g,",").replace(/\+/g," ");
}

function parseQS() {
	// Remove leading question mark ("?") and split into array of key/value pairs
	var qsArray = location.search.slice(1).split("&");
	// Initialize object to store key/value pairs
	var json = {};
	// Loop through key/value pairs and separate into keys and values
	for ( var i = 0; i < qsArray.length; i++ ) {
		var kv = qsArray[i].split("=");
		var key = kv[0];
		var val;
		if ( kv.length == 1 ) val = key;
		// A key may be present without a value, so set a placeholder value
		else val = kv[1];
		json[key] = val;
	}
	return json;
}

function checkQS() {
	var qs = parseQS();
	if ( !(qs.title===undefined) || !(qs.words===undefined) ) {
		$("#intro").hide();
		if ( !(qs.title===undefined) ) {
			$("#title").attr("value",urlUnencode(qs.title));
		}
		if ( !(qs.words===undefined) ) {
			$("#words").html(urlUnencode(qs.words));
		}
		if ( !(qs.freespace===undefined) ) {
			document.getElementById("freespaceValue").selectedIndex = 0;
			$("#freespaceValue").attr("value",urlUnencode(qs.freespace));
			if ( !(qs.freespaceRandom===undefined) && qs.freespaceRandom==="true" ) {
				document.getElementById("freespaceRandom").selectedIndex = 0;
			}
		} else {		
			document.getElementById("freespaceValue").selectedIndex = 1;
			$("#freespaceValue").attr("value","");
		}
		if ( !(qs.width===undefined) ) {
			$("#width").attr("value",qs.width);
		}
		if ( !(qs.height===undefined) ) {
			$("#height").attr("value",qs.height);
		}
		if ( !(qs.number===undefined) ) {
			$("#number").attr("value",qs.number);
		}
	}
	if ( !(qs.title===undefined) && !(qs.words===undefined) ) {
		generate();
	}
}

$(document).ready(checkQS);


</script>
</head>
<body>
<h1>Make your own bingo cards</h1>
<form action="#results" method="get"><!-- onsubmit="generate();return false;" -->
	<p id="intro">I've provided a sample to create bingo cards for a day in the park. You can enter your own settings to create your own custom bingo cards.</p>
	<fieldset>
		<legend>Bingo Card Basics</legend>
		<label>Card Title <input type="text" name="title" id="title" value="Day in the Park Bingo"></label>
		<label>Word List (separated by commas)</label><textarea cols="60" rows="8" name="words" id="words">Flowers,Bees,Picnickers,Ants,Little Kid Crying,Holding Hands,Person Napping,A Balloon,Dogs,Frisbee,Stroller,Chess Players,Rollerskates,Musician,Juggler,Photographer,Painter,Plastic Bag in Tree,Squirrel,Pigeon,Bicycle Built for Two,Ice Cream,Sunbather,Person Reading Newspaper,Person Listening to Radio,Sidewalk Chalk,Hopscotch</textarea>
	</fieldset>	

	<fieldset>
		<legend>Free Space</legend>
		<label>Include a free space? 
			<select name="freespace" id="freespace">
				<option value="true" selected="selected">Yes</option>
				<option value="false">No</option>
			</select>
		</label>
		<label>Free Space Text <input type="text" name="freespace" id="freespaceValue" value="Park Bench"></label>
		<label>Free Space Placement
			<select name="freespaceRandom" id="freespaceRandom">
				<option value="true">Random</option>
				<option value="false" selected="selected">Center</option>
			</select>
		</label>
	</fieldset>

	<fieldset>
		<legend>Card Size</legend>
		<p>A 5x5 bingo card is traditional, but you can try other sizes</p>
		<label>Number of Squares Wide <input type="text" name="width" id="width" value="5"></label>
		<label>Number of Squares Tall <input type="text" name="height" id="height" value="5"></label>
	</fieldset>

	
	<fieldset>
		<legend>Printing Options</legend>
		<p>Select the <em>landscape</em> page layout when printing for best results</p>
		<label>Number of cards to create <input type="text" name="number" id="number" value="10"></label>
	</fieldset>
	<label><input type="submit" value="Generate Bingo Cards"></label>
</form>


<div id="results"></div>

<div id="footer">
Questions? Comments? Contact chris @ osric . com
</div>

</body>
</html>